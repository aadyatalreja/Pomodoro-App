<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pomodoro Timer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(160deg, #e8f4f8 0%, #f0ebe6 50%, #f5f0eb 100%);
      padding: 1rem;
    }
    .card {
      background: rgba(255, 255, 255, 0.82);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      padding: 2.25rem;
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06), 0 2px 8px rgba(0, 0, 0, 0.04);
      text-align: center;
      min-width: 340px;
      max-width: 420px;
      transition: box-shadow 0.4s ease, background 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.6);
    }
    .card.state-running { box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08), 0 4px 16px rgba(0, 0, 0, 0.04); }
    .card.state-running.mode-focus { box-shadow: 0 12px 48px rgba(46, 125, 50, 0.18); }
    .card.state-running.mode-shortBreak { box-shadow: 0 12px 48px rgba(0, 150, 136, 0.18); }
    .card.state-running.mode-longBreak { box-shadow: 0 12px 48px rgba(123, 31, 162, 0.18); }
    .card.state-running.mode-custom { box-shadow: 0 12px 48px rgba(46, 125, 50, 0.18); }
    .card.state-paused { box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06); }
    .card.state-finished { box-shadow: 0 12px 48px rgba(46, 125, 50, 0.2); }

    h1 {
      margin: 0 0 1.25rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: #1a1a1a;
      letter-spacing: -0.02em;
    }

    .presets {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    .presets button {
      padding: 0.6rem 1rem;
      min-height: 44px;
      border: 2px solid transparent;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      color: #555;
      transition: all 0.25s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    .presets button:hover:not(:disabled) {
      background: #fff;
      color: #333;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    .presets button:active:not(:disabled) { transform: scale(0.98); }
    .presets button:focus-visible { outline: 2px solid #2e7d32; outline-offset: 2px; }
    .presets button:disabled { opacity: 0.5; cursor: not-allowed; }
    .presets button.active[data-preset="focus"] {
      background: #2e7d32;
      border-color: #2e7d32;
      color: #fff;
    }
    .presets button.active[data-preset="shortBreak"] {
      background: #00897b;
      border-color: #00897b;
      color: #fff;
    }
    .presets button.active[data-preset="longBreak"] {
      background: #7b1fa2;
      border-color: #7b1fa2;
      color: #fff;
    }

    .timer {
      font-size: 4rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      margin-bottom: 0.5rem;
      color: #1a1a1a;
      transition: color 0.35s ease;
      line-height: 1.1;
    }
    .card.state-running.mode-focus .timer { color: #1b5e20; }
    .card.state-running.mode-shortBreak .timer { color: #00695c; }
    .card.state-running.mode-longBreak .timer { color: #4a148c; }
    .card.state-paused .timer { color: #424242; }
    .card.state-finished .timer { color: #1b5e20; }

    .message {
      min-height: 1.75rem;
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 1.25rem;
      transition: color 0.3s ease;
      color: #555;
    }
    .card.state-running.mode-focus .message { color: #2e7d32; }
    .card.state-running.mode-shortBreak .message { color: #00695c; }
    .card.state-running.mode-longBreak .message { color: #4a148c; }
    .card.state-paused .message { color: #616161; }
    .card.state-finished .message { color: #1b5e20; font-weight: 600; }
    .message.error { color: #b71c1c; }

    .progress-wrap {
      height: 10px;
      background: rgba(0, 0, 0, 0.06);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 1.5rem;
      transition: background 0.3s ease;
    }
    .progress-fill {
      height: 100%;
      width: 100%;
      border-radius: 10px;
      transition: width 1s linear, background 0.35s ease;
    }
    .card.state-idle .progress-fill,
    .card.state-paused .progress-fill { background: #9e9e9e; }
    .card.state-running.mode-focus .progress-fill { background: #2e7d32; }
    .card.state-running.mode-shortBreak .progress-fill { background: #00897b; }
    .card.state-running.mode-longBreak .progress-fill { background: #7b1fa2; }
    .card.state-running.mode-custom .progress-fill { background: #2e7d32; }
    .card.state-finished .progress-fill { background: #2e7d32; }

    .controls {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .controls button {
      padding: 0.75rem 1.5rem;
      min-height: 48px;
      min-width: 100px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
    }
    .controls button:hover:not(:disabled) { transform: translateY(-2px); }
    .controls button:active:not(:disabled) { transform: translateY(0); }
    .controls button:focus-visible { outline: 2px solid #1a1a1a; outline-offset: 2px; }
    .controls button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-start {
      background: #2e7d32;
      color: #fff;
      box-shadow: 0 4px 14px rgba(46, 125, 50, 0.35);
    }
    .btn-start:hover:not(:disabled) { background: #1b5e20; box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4); }
    .card.state-idle .btn-start { animation: softGlow 2.5s ease-in-out infinite; }
    @keyframes softGlow {
      0%, 100% { box-shadow: 0 4px 14px rgba(46, 125, 50, 0.35); }
      50% { box-shadow: 0 4px 20px rgba(46, 125, 50, 0.5); }
    }
    .btn-pause { background: #757575; color: #fff; }
    .btn-pause:hover:not(:disabled) { background: #616161; }
    .btn-reset {
      background: rgba(0, 0, 0, 0.06);
      color: #424242;
      border: 1px solid rgba(0, 0, 0, 0.08);
    }
    .btn-reset:hover:not(:disabled) { background: rgba(0, 0, 0, 0.1); color: #1a1a1a; }

    .secondary {
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 1px solid rgba(0, 0, 0, 0.06);
    }
    .secondary-toggle {
      background: none;
      border: none;
      color: #555;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      padding: 0.4rem 0;
      margin-bottom: 0.75rem;
      transition: color 0.2s ease;
    }
    .secondary-toggle:hover { color: #1a1a1a; }
    .secondary-toggle:focus-visible { outline: 2px solid #2e7d32; outline-offset: 2px; border-radius: 4px; }
    .custom-duration {
      display: none;
      margin-bottom: 1rem;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 12px;
    }
    .custom-duration.visible { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .custom-duration label { margin-right: 0.5rem; color: #424242; font-size: 0.9rem; }
    .custom-duration input {
      width: 4rem;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.12);
      font-size: 0.95rem;
      text-align: center;
      background: #fff;
    }
    .custom-duration input:focus { outline: 2px solid #2e7d32; outline-offset: 0; }
    .custom-duration input:disabled { opacity: 0.6; cursor: not-allowed; background: #f5f5f5; }
    .custom-duration .apply {
      margin-left: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.08);
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s ease;
    }
    .custom-duration .apply:hover:not(:disabled) { background: rgba(0, 0, 0, 0.1); }

    .extras {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-top: 0.75rem;
    }
    .pomodoro-count { font-size: 0.9rem; color: #555; }
    .sound-toggle {
      background: rgba(0, 0, 0, 0.04);
      border: 1px solid rgba(0, 0, 0, 0.08);
      padding: 0.5rem 1rem;
      min-height: 44px;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      color: #424242;
      transition: all 0.2s ease;
    }
    .sound-toggle:hover { background: rgba(0, 0, 0, 0.08); color: #1a1a1a; }
    .sound-toggle:focus-visible { outline: 2px solid #2e7d32; outline-offset: 2px; }
    .sound-toggle.muted { opacity: 0.7; }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
  </style>
</head>
<body>
  <div class="card state-idle mode-focus" id="card">
    <h1>Pomodoro Timer</h1>

    <div class="presets" role="group" aria-label="Session presets">
      <button type="button" class="preset active" data-preset="focus" data-mins="25" aria-pressed="true">Focus (25 min)</button>
      <button type="button" class="preset" data-preset="shortBreak" data-mins="5" aria-pressed="false">Short Break (5 min)</button>
      <button type="button" class="preset" data-preset="longBreak" data-mins="15" aria-pressed="false">Long Break (15 min)</button>
    </div>

    <div class="timer" id="timer" aria-live="polite">25:00</div>
    <div class="message" id="message" aria-live="polite"></div>

    <div class="progress-wrap">
      <div class="progress-fill" id="progressBar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
    </div>

    <div class="controls">
      <button type="button" class="btn-start" id="btnStart" aria-label="Start timer">Start</button>
      <button type="button" class="btn-pause" id="btnPause" aria-label="Pause timer">Pause</button>
      <button type="button" class="btn-reset" id="btnReset" aria-label="Reset timer">Reset</button>
    </div>

    <div class="secondary">
      <button type="button" class="secondary-toggle" id="btnToggleCustom" aria-expanded="false" aria-controls="customDuration">Custom time</button>
      <div class="custom-duration" id="customDuration" role="region" aria-label="Custom duration">
        <label for="customMins">Minutes (1â€“90):</label>
        <input type="number" id="customMins" min="1" max="90" value="25" aria-label="Custom duration in minutes">
        <button type="button" class="apply" id="btnApplyCustom">Apply</button>
      </div>
      <div class="extras">
        <span class="pomodoro-count" id="pomodoroCount">Pomodoros completed: 0</span>
        <button type="button" class="sound-toggle" id="btnSound" aria-pressed="false" aria-label="Mute sound">Sound on</button>
      </div>
    </div>

    <audio id="alarm" preload="auto" aria-hidden="true">
      <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleB0A" type="audio/wav">
    </audio>
  </div>

  <script>
    var remainingSeconds = 25 * 60;
    var totalSeconds = 25 * 60;
    var intervalId = null;
    var isRunning = false;
    var currentPreset = 'focus';
    var soundMuted = false;
    var pomodoroCount = parseInt(localStorage.getItem('pomodoroCount') || '0', 10);

    var card = document.getElementById('card');
    var timerEl = document.getElementById('timer');
    var messageEl = document.getElementById('message');
    var progressBar = document.getElementById('progressBar');
    var customMinsInput = document.getElementById('customMins');
    var customDurationEl = document.getElementById('customDuration');
    var btnToggleCustom = document.getElementById('btnToggleCustom');
    var alarmEl = document.getElementById('alarm');
    var btnSound = document.getElementById('btnSound');

    var statusCopy = {
      focus: 'Stay focused âœ¨',
      shortBreak: 'Take a short break âœ¨',
      longBreak: 'Relax â€” long break âœ¨',
      custom: 'Session in progress âœ¨',
      paused: 'Paused â€” take a breath',
      finished: 'Great job! Session complete ðŸŽ‰'
    };

    function setUIState(state) {
      card.className = card.className.replace(/\s*state-\w+/g, '') + ' state-' + state;
    }

    function setMode(mode) {
      card.className = card.className.replace(/\s*mode-\w+/g, '') + ' mode-' + (mode || 'focus');
    }

    function formatTime(sec) {
      var m = Math.floor(sec / 60);
      var s = sec % 60;
      return (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
    }

    function updateDisplay() {
      timerEl.textContent = formatTime(remainingSeconds);
      var pct = totalSeconds > 0 ? Math.max(0, (remainingSeconds / totalSeconds) * 100) : 0;
      progressBar.style.width = pct + '%';
      progressBar.setAttribute('aria-valuenow', Math.round(pct));
    }

    function updatePomodoroCount() {
      document.getElementById('pomodoroCount').textContent = 'Pomodoros completed: ' + pomodoroCount;
      try { localStorage.setItem('pomodoroCount', String(pomodoroCount)); } catch (e) {}
    }

    function setPresetActive(preset) {
      document.querySelectorAll('.preset').forEach(function (btn) {
        var isActive = btn.getAttribute('data-preset') === preset;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
      });
    }

    function setDuration(mins, preset) {
      if (preset !== undefined) currentPreset = preset;
      mins = Math.max(1, Math.min(90, mins));
      totalSeconds = mins * 60;
      remainingSeconds = totalSeconds;
      customMinsInput.value = mins;
      setMode(currentPreset === 'custom' ? 'custom' : currentPreset);
      updateDisplay();
    }

    function tick() {
      if (remainingSeconds <= 0) {
        clearInterval(intervalId);
        intervalId = null;
        isRunning = false;
        setUIState('finished');
        setMode(currentPreset === 'custom' ? 'custom' : currentPreset);
        setControlsDisabled(false);
        messageEl.textContent = statusCopy.finished;
        messageEl.classList.remove('error');
        if (currentPreset === 'focus') {
          pomodoroCount++;
          updatePomodoroCount();
        }
        if (!soundMuted) {
          try { alarmEl.currentTime = 0; alarmEl.play(); } catch (e) {}
        }
        return;
      }
      remainingSeconds--;
      updateDisplay();
    }

    function setControlsDisabled(disabled) {
      document.querySelectorAll('.preset').forEach(function (b) { b.disabled = disabled; });
      customMinsInput.disabled = disabled;
      document.getElementById('btnApplyCustom').disabled = disabled;
    }

    function startTimer() {
      if (isRunning) return;
      isRunning = true;
      setUIState('running');
      setMode(currentPreset === 'custom' ? 'custom' : currentPreset);
      setControlsDisabled(true);
      messageEl.textContent = statusCopy[currentPreset] || statusCopy.custom;
      messageEl.classList.remove('error');
      if (intervalId) clearInterval(intervalId);
      intervalId = setInterval(tick, 1000);
    }

    function pauseTimer() {
      if (!isRunning) return;
      isRunning = false;
      setUIState('paused');
      setControlsDisabled(false);
      if (intervalId) { clearInterval(intervalId); intervalId = null; }
      messageEl.textContent = statusCopy.paused;
      messageEl.classList.remove('error');
    }

    function resetTimer() {
      if (intervalId) { clearInterval(intervalId); intervalId = null; }
      isRunning = false;
      setUIState('idle');
      setMode(currentPreset === 'custom' ? 'custom' : currentPreset);
      setControlsDisabled(false);
      var mins = parseInt(customMinsInput.value, 10) || 25;
      mins = Math.max(1, Math.min(90, mins));
      setDuration(mins, currentPreset);
      messageEl.textContent = '';
      messageEl.classList.remove('error');
    }

    function applyPreset(mins, preset) {
      if (isRunning) return;
      setDuration(mins, preset);
      setPresetActive(preset);
      messageEl.textContent = '';
      messageEl.classList.remove('error');
    }

    function applyCustomDuration() {
      if (isRunning) return;
      var raw = customMinsInput.value.trim();
      var mins = parseInt(raw, 10);
      if (raw === '' || isNaN(mins) || mins < 1 || mins > 90) {
        messageEl.textContent = 'Please enter 1â€“90 minutes';
        messageEl.classList.add('error');
        return;
      }
      setDuration(mins, 'custom');
      setPresetActive(null);
      messageEl.textContent = '';
      messageEl.classList.remove('error');
    }

    btnToggleCustom.addEventListener('click', function () {
      var open = customDurationEl.classList.toggle('visible');
      btnToggleCustom.setAttribute('aria-expanded', open ? 'true' : 'false');
      btnToggleCustom.textContent = open ? 'Hide custom time' : 'Custom time';
    });

    document.querySelectorAll('.preset').forEach(function (btn) {
      btn.addEventListener('click', function () {
        if (btn.disabled) return;
        applyPreset(parseInt(btn.getAttribute('data-mins'), 10), btn.getAttribute('data-preset'));
      });
    });

    document.getElementById('btnStart').addEventListener('click', startTimer);
    document.getElementById('btnPause').addEventListener('click', pauseTimer);
    document.getElementById('btnReset').addEventListener('click', resetTimer);
    document.getElementById('btnApplyCustom').addEventListener('click', applyCustomDuration);

    customMinsInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') applyCustomDuration();
    });

    btnSound.addEventListener('click', function () {
      soundMuted = !soundMuted;
      btnSound.classList.toggle('muted', soundMuted);
      btnSound.setAttribute('aria-pressed', soundMuted ? 'true' : 'false');
      btnSound.textContent = soundMuted ? 'Sound off' : 'Sound on';
    });

    document.addEventListener('keydown', function (e) {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      if (e.code === 'Space') {
        e.preventDefault();
        if (isRunning) pauseTimer(); else startTimer();
      } else if (e.code === 'KeyR') {
        e.preventDefault();
        resetTimer();
      }
    });

    updateDisplay();
    updatePomodoroCount();
  </script>
</body>
</html>
